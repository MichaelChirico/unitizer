<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Brodie Gaslam" />

<meta name="date" content="2014-12-04" />

<title>unitizeR - Demo Companion</title>




<link href="data:text/css,%2F%2A%0AStyles%20primarily%20borrowed%20from%20rmarkdown%2Ftemplates%2Fhtml%5Fvignette%2Fresources%2Fvignette%2Ecss%0Aat%20a%20time%2012%2F2%2F2014%20when%20rmarkdown%20was%20%28and%20probably%20still%20is%29%20under%20the%20GPL%2D3%0Alicense%0A%2A%2F%0A%0Abody%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E5%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20%2F%2Amargin%3A%200%200%2010px%2010px%3B%2A%2F%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20100%25%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%201em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23eee%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23eee%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%2C%20h1%20%3E%20code%2C%20h2%20%3E%20code%2C%20h3%20%3E%20code%2C%0Ah4%20%3E%20code%2C%20h5%20%3E%20code%2C%20h6%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%20%20line%2Dheight%3A%201%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%7D%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20padding%2Dbottom%3A%203px%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23999%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23999%3B%0A%20%20padding%2Dtop%3A%205px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20padding%2Dtop%3A%205px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20%2F%2Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%2A%2F%0A%20%20color%3A%20%23777%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah4%2Eauthor%2C%20h4%2Edate%20%7Bdisplay%3A%20none%3B%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20%2F%2Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%2A%2F%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%232255dd%3B%0A%20%20font%2Dweight%3A%20bold%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">unitizeR - Demo Companion</h1>
<h4 class="author"><em>Brodie Gaslam</em></h4>
<h4 class="date"><em>2014-12-04</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#running-the-demo">Running the Demo</a></li>
<li><a href="#about-the-demo">About The Demo</a></li>
</ul></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#notes-on-simulating-unitizer-use-in-this-demo">Notes on Simulating <code>unitizer</code> Use In This Demo</a></li>
<li><a href="#creating-the-test-file">Creating the Test File</a></li>
<li><a href="#installing-the-package">Installing the Package</a></li>
</ul></li>
<li><a href="#initial-run">Initial Run</a></li>
<li><a href="#second-run-check-for-regressions">Second Run – Check For Regressions</a></li>
<li><a href="#third-run-fix-problems">Third Run – Fix Problems</a></li>
</ul>
</div>

<div id="introduction" class="section level2">
<h2>Introduction</h2>
<div id="running-the-demo" class="section level3">
<h3>Running the Demo</h3>
<p>This vignette is the companion to the demo you get if you run:</p>
<pre><code>library(unitizer)
demo(unitizer)</code></pre>
<p>We recommend you read this document as you run the demo. Due to the interactive nature of the demo we cannot easily embed it within this document, so please be forgiving of small discrepancies you may find between what the demo shows and what we discuss here.</p>
</div>
<div id="about-the-demo" class="section level3">
<h3>About The Demo</h3>
<p>The demo is simulates the process of developing a package while using <code>unitizer</code> for your unit tests. It will walk you through:</p>
<ol start="0" style="list-style-type: decimal">
<li>Creating a test file and installing the package we will test</li>
<li><code>unitize</code>ing our test file (i.e. turning it into <code>unitizer</code> tests)</li>
<li>Modifying the package and re-<code>unitize</code>ing to check for regressions</li>
<li>Finding regressions, fixing them, and confirming they are fixed with <code>unitize</code></li>
</ol>
<p>We will use the pseudo package <code>unitizer.fastlm</code> which is provided as part of the <code>unitizer</code> sources. <code>unitizer.fastlm</code> fits a single variable linear model (i.e. <code>y ~ x</code>) and returns slope, intercept, and R squared. The limited scope of the functionality means we can rely on fast computations to produce the results.</p>
</div>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div id="notes-on-simulating-unitizer-use-in-this-demo" class="section level3">
<h3>Notes on Simulating <code>unitizer</code> Use In This Demo</h3>
<p>Unfortunately the demo is complicated by the need to automate some steps that would normally be taken by the package developer. We try to isolate these steps to the “Setup” section of the demo so that the rest of the <code>demo</code> is as close as possible to a typical <code>unitizer</code> experience.</p>
<p>When you run <code>demo(unitizer)</code> you will first see something like:</p>
<pre><code>&gt; {
+   if(!require(devtools)) stop(&quot;Package `devtools` is required for this demo.&quot;)
+   library(unitizer)
+   if(exists(&quot;.unitizer.test.file&quot;)) stop(&quot;Cannot run if variable `.unitizer.test.file` is defined&quot;)
+ }

&gt; # In this script we will demonstrate the `unitize` workflow by running `unitize`
... several lines omitted ...
&gt; prompt_to_proceed()
[Press ENTER to Continue]</code></pre>
<p>We will be using <code>devtools::install</code> as part of the demo, which is why we require <code>devtools</code>. We will also be using the <code>.unitizer.test.file</code> variable so we want to make sure it isn’t already defined so we do not overwrite it.</p>
<p>Throughout the demo, you will see calls to <code>prompt_to_proceed()</code>. All this function does is pause the evaluation of the demo to give you an opportunity to read through the console output up to that point. This function is technically part of <code>unitizer</code>, but it is intended for use solely by the demo. You will not need to use this function when you use <code>unitizer</code>.</p>
<p>The text ahead of the prompt gives you a quick summary of what the demo is about, and then tells you we are about to create a test file.</p>
</div>
<div id="creating-the-test-file" class="section level3">
<h3>Creating the Test File</h3>
<p>After your press ENTER at the next couple of prompts you will see something like:</p>
<pre><code>&gt; # Write tests to temp file by `cat`ing a string to a `tempfile()`
&gt;
&gt; cat(
+   file=(.unitizer.test.file &lt;- tempfile(fileext=&quot;.R&quot;)),
+   &quot;# Calls to `library` and assignments are not normally considered tests, so
+   # you will not be prompted to review them
+
+   library(unitizer.fastlm)
+   x &lt;- 1:100
+   y &lt;- x ^ 2
+   res &lt;- fastlm(x, y)
+
+   res                     # first reviewable expression
+   get_slope(res)
+   get_rsq(res)
+
+   fastlm(x, head(y))      # This should cause an error; press Y to add to store\n&quot;
+ )</code></pre>
<p>Normally you would create the test file in your favorite text editor and save it to a reasonable place in your file system (e.g. <code>~/mypackages/unitizer.fastlm/tests/unitizer/fastlm.R</code>), but because we need the demo to create the test file we will <code>cat</code> out the character string containing our tests into a temporary file. The name of that file is stored in the variable <code>.unitizer.test.file</code>.</p>
</div>
<div id="installing-the-package" class="section level3">
<h3>Installing the Package</h3>
<p>After we create our test file we will install <code>unitizer.fastlm</code> with:</p>
<pre><code>install(fastlm_dir(version=0))</code></pre>
<p><code>install</code> here is just <code>devtools::install</code>. <code>fastlm_dir</code> is a helper function that returns the location of our <code>unitizer.fastlm</code> package within the <code>unitizer</code> package (it is in <code>inst/example.pkgs</code> in the sources). The reason we use <code>fastlm_dir</code> is that the <code>unitizer</code> package actually includes three different versions of the <code>unitizer.fastlm</code> package. Each version is supposed to represent the state of our package at a different point in development:</p>
<ul>
<li><code>fastlm_dir(version=0)</code> is basically a mock-up that just wraps <code>stats::lm</code>; the nice thing about it is it gives us a known correct starting point which is very useful for our initial tests</li>
<li><code>fastlm_dir(version=1)</code> is our first attempt at implementing our own computations for slope / intercept / R squared, but it is not properly implemented</li>
<li><code>fastlm_dir(version=2)</code> is the final versions with the correct computations</li>
</ul>
<p>In normal <code>unitizer</code> use we would just be modifying the sources of our package and re-instaling the exact same package, but for the purposes of our demo we must rely on these pre-existing versions of the <code>unitizer.fastlm</code> package.</p>
<p>Once we are done with the setup and ready to <code>unitize</code>, you will see:</p>
<pre><code>&gt; # ~~~~~~~~~~~~~~~~~~~~~~~~~~ SETUP COMPLETE ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
&gt;
&gt; prompt_to_proceed()
[Press ENTER to Continue]</code></pre>
</div>
</div>
<div id="initial-run" class="section level2">
<h2>Initial Run</h2>
<p>We run <code>unitize</code>:</p>
<pre><code>&gt; unitize(test.file)</code></pre>
<p>This launches the interactive user environment. Consider the first portion of <code>unitizer</code> output:</p>
<pre><code>+-----------------------------------------------------------------------------+
| unitizer for: /var/folders/56/qcx6p6f94695mh7ywq9m6z_80000gq/T//RtmpbDH8w9/ |
| filee6924af3d708.R                                                          |
+-----------------------------------------------------------------------------+

  Pass  Fail   New
     0     0     4</code></pre>
<p>The banner across the top gives us the location of the test file we are <code>unitize</code>ing. We get a gnarly name here because we are using a temp file, though in typical use it would be a more normal looking file name.</p>
<p>Below the banner is a summary of our test file. This summary tells us that we have four new tests. This is important because <code>unitizer</code> requires that we review any new tests to confirm they actually produce the desired outcome.</p>
<p>If there are any non-passed tests, as is the case here, <code>unitizer</code> will automatically bring up a prompt for review of the tests that require it, as is the case here:</p>
<pre><code>- New -------------------------------------------------------------------------

Test script contains tests not present in unitizer. Add new item to store (
[Y]es, [N]o, [B]ack, [R]eview, [Q]uit, [H]elp)?

# Calls to `library` and assignments are not normally considered tests, so
# you will not be prompted to review them
&gt; library(unitizer.fastlm)
&gt; x &lt;- 1:100
&gt; y &lt;- x^2
&gt; res &lt;- fastlm(x, y)
# first reviewable expression
&gt; res
   intercept        slope          rsq
-1717.000000   101.000000     0.938679
attr(,&quot;class&quot;)
[1] &quot;fastlm&quot;
unitizer&gt;</code></pre>
<p>The banner tells us we are about to review new tests (as opposed to existing tests that failed, for example). Right under the banner is a question addressed to the user. In this case <code>unitizer</code> wants to know whether we are satisfied with the result of the test and wish for it to be formally added to the <code>unitizer</code> store. We must carefully review the test results because once we add that result to the store it becomes the correct result as far as <code>unitizer</code> is concerned.</p>
<p>In the parentheses at the end of the question are the options available to the user. You can type any of the letters in square brackets at the <code>unitizer&gt;</code> prompt, and <code>unitizer</code> will recognize them as commands.</p>
<p>Following the question, <code>unitizer</code> starts showing you the results of evaluating the test file and eventually stops after the first test with a <code>unitizer&gt;</code> prompt. Note that neither simple assignment expressions or calls to <code>library</code> are considered tests, which is why the <code>unitizer&gt;</code> prompt only appears after the <code>&gt; res</code> line. The reason for not treating assignments as tests is that presumably assignments will be re-used elsewhere in the test file, at which point they will cause problems if they are incorrect. By ignoring the original assignment we reduce the number of tests that need to be reviewed. We ignore <code>library</code> because its primary purpose is to produce side effects and its output is not necessarily meaningful in the context of unit tests.</p>
<p>In addition to accepting the <code>unitizer</code> commands highlighted earlier (i.e. Y, N, etc.), the <code>unitizer&gt;</code> prompt allows you to run arbirary R expressions. We can use this to check that our function did what it is supposed to:</p>
<pre><code>unitizer&gt; lm(y ~ x, data.frame(x, y))$coefficients
(Intercept)           x
      -1717         101
unitizer&gt; summary(lm(y ~ x, data.frame(x, y)))$r.squared
[1] 0.938679</code></pre>
<p>Sure enough, it looks like our function did what it was supposed to do. We can accept the test by typing Y at the prompt. If the result looked incorrect, we could reject it by typing N. If you happened to have a variable called Y or N as part of your tests, you could access them by using typing <code>(Y)</code>, or <code>get(Y)</code>, or any other expression that evaluates to your variable.</p>
<pre><code>unitizer&gt; Y
&gt; get_slope(res)
[1] 101</code></pre>
<p>This brings up our next test, which also looks correct, so we will also acccept it (and the next one too), leading to:</p>
<pre><code>unitizer&gt; Y
&gt; get_rsq(res)
[1] 0.938679
unitizer&gt; Y
# This should cause an error; press Y to add to store
&gt; fastlm(x, head(y))
Error in fastlm(x, head(y)) :
  Arguments `x` and `y` must be the same length.</code></pre>
<p>The last test caused an error. It was supposed to as the inputs were purposefully wrong. We want to store this particular error to ensure that in the future our function keeps erroring out in the same way with this type of erroneous input. Conveniently all we have to do is hit Y at the prompt as we did with our other tests. The error becomes part of the store and any future re-runs will compare the result of the expression against the stored error and will notify if the expression fails to produce an error or produces a different error. This brings us to the final prompt:</p>
<pre><code>unitizer&gt; Y
= Finalize Unitizer ===========================================================

You are about to IRREVERSIBLY:
- Add 4 out of 4 new tests
Update unitizer ([Y]es, [N]o, [B]ack, [R]eview)?</code></pre>
<p>So far we have only queued the tests for storage. By answering <code>Y</code> at this prompt we will be storing all the tests we accepted into the unitizer store:</p>
<pre><code>unitizer&gt; Y
unitizer updated</code></pre>
<p>After the above screen output we have exited from <code>unitize</code> and the demo picks up again. For educational purposes, we will break away from the demo for a second here and type at the R prompt (do not do this yourself):</p>
<pre><code>&gt; list.files(dirname(test.file))
[1] &quot;filee6924af3d708.R&quot;        &quot;filee6924af3d708.unitizer&quot;</code></pre>
<p>We redacted the above for clarity since there are often other files in the temporary directory, but you can see that in the directory that contains <code>test.file</code>, there is both our <code>test.file</code> and a new directory ending in <code>.unitizer</code> created by <code>unitize</code>. Our four new tests and their accepted results are stored in that directory. Obviously the <code>.unitizer</code> directory would not normally be in a temporary directory as we want our stored tests to persist, but again, we are putting it here for the purposes of the demo.</p>
</div>
<div id="second-run-check-for-regressions" class="section level2">
<h2>Second Run – Check For Regressions</h2>
<p>As you know <code>unitizer.fastlm</code> isn’t fast at all. It is just a wrapper for the standard <code>lm</code> function. We will now modify <code>unitizer.fastlm</code> to use our new fast computations. For our demo purposes, all we need to do is install the new version of the package:</p>
<pre><code>&gt; install(fastlm_dir(version=1))</code></pre>
<p>And re-run <code>unitize</code> to make sure we did it right:</p>
<pre><code>&gt; unitize(test.file)
+-----------------------------------------------------------------------------+
| unitizer for: /var/folders/56/qcx6p6f94695mh7ywq9m6z_80000gq/T//RtmpbDH8w9/ |
| filee6922bc66583.R                                                          |
+-----------------------------------------------------------------------------+

  Pass  Fail   New
     2     2     0</code></pre>
<p>Clearly something is wrong. Two tests failed. <code>unitizer</code> prompts us to review the failed tests and decide whether to replace the existing tests with the new ones:</p>
<pre><code>- Failed ----------------------------------------------------------------------

Reference test does not match new test from test script (compare `.new` and
`.ref` to see differences). Overwrite item in store with new value ([Y]es,
[N]o, [B]ack, [R]eview, [Q]uit, [H]elp)?

&gt; res &lt;- fastlm(x, y)
# first reviewable expression
&gt; res
Test Failed Because:
Value mismatch: Mean relative difference: 19854602162
unitizer&gt;</code></pre>
<p><code>unitizer</code> is telling us the value of our test does not match the reference value. Notice at the top how <code>unitizer</code> suggests we use <code>.new</code> and <code>.ref</code> to compare our results. Consider:</p>
<pre><code>unitizer&gt; .new
    intercept         slope           rsq
-3.541306e+13  7.012486e+11  9.386790e-01
attr(,&quot;class&quot;)
[1] &quot;fastlm&quot;
unitizer&gt; .ref
   intercept        slope          rsq
-1717.000000   101.000000     0.938679
attr(,&quot;class&quot;)
[1] &quot;fastlm&quot;
unitizer&gt;</code></pre>
<p><code>.new.</code> and <code>.ref</code> are special objects created by <code>unitizer</code> to allow us to easily compare our new test results to previously stored test results. By using them here it becomes obvious that both our intercept and slope calculations are completely wrong in our updated package. The rsq value looks correct though. We could also have re-evaluated our test instead of typing <code>.new</code> at the prompt, but if the computation is slow using <code>.new</code> avoids recomputation. The only way to get the original value is with <code>.ref</code></p>
<p>Since this new test is wrong, we will reject it as well as the subsequent related tests by typing N at the prompt:</p>
<pre><code>unitizer&gt; N
&gt; get_slope(res)
Test Failed Because:
Value mismatch: Mean relative difference: 6943055624
unitizer&gt; N
= Finalize Unitizer ===========================================================

You didn't accept any changes so there are no items to store.
Exit unitizer ([Y]es, [B]ack, [R]eview)?
unitizer&gt;</code></pre>
<p>This brings us up to the final prompt. Since we rejected all the items that do not match the existing stored items, <code>unitizer</code> tells us that it will not modify the underlying store. We are still prompted at the end so that we have an opportunity to make changes if we made a mistake. Both the <code>[B]ack</code> and <code>[R]eview</code> options allow us to re-review the tests (see <a href="04interactiveenvironment.html#test-navigation">test navigation</a> for more details).</p>
</div>
<div id="third-run-fix-problems" class="section level2">
<h2>Third Run – Fix Problems</h2>
<p>We figured out the problem in our new implementation of <code>fastlm</code> and fixed it. Now we update our package and re-run <code>unitize</code>:</p>
<pre><code>&gt; install(fastlm_dir(version=2))
&gt; unitize(test.file)
+-----------------------------------------------------------------------------+
| unitizer for: /var/folders/56/qcx6p6f94695mh7ywq9m6z_80000gq/T//RtmpbDH8w9/ |
| filee6922bc66583.R                                                          |
+-----------------------------------------------------------------------------+

  Pass  Fail   New
     4     0     0

All tests passed.
unitizer store unchanged</code></pre>
<p>Success! Since all our tests passed we know that our functionality is implemented properly. We can now comfortably make further modifications to <code>unitizer.fastlm</code> knowing that any regressions we introduce to existing functionality will be detected by <code>unitize</code>.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
